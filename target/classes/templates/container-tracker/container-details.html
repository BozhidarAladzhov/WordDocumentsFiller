<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title>Container Tracker - Details</title>
    <link rel="stylesheet" href="/css/app.css">
</head>
<body>
<div th:replace="fragments/navbar :: main-nav"></div>

<div class="container tools tracker tracker--wide">
    <div class="tracker-topbar">
        <div>
            <h1 class="tracker-title" th:text="'Container: ' + ${container.containerNo}">Container</h1>
        </div>

        <a class="btn btn-ghost"
           th:href="@{/container-tracker/containers/{id}/unloading(id=${container.id})}">
            Unloading
        </a>


        <div class="tracker-actions">
            <a class="btn btn-ghost" th:href="@{/container-tracker/containers}">← Back</a>
        </div>
    </div>

    <div class="details-card details-card--compact">

        <form id="containerEditForm"
              th:action="@{/container-tracker/containers/{id}/update(id=${container.id})}"
              method="post"
              class="details-form">

            <!-- ONE-LINE INFO ROW -->
            <div class="details-row">

                <div class="field">
                    <label>Container No</label>
                    <input th:value="${container.containerNo}" readonly>
                </div>

                <div class="field">
                    <label>BOL</label>
                    <input name="bol" th:value="${container.bol}" placeholder="BOL…">
                </div>

                <div class="field">
                    <label>Carrier</label>
                    <input name="carrier" th:value="${container.carrier}" placeholder="Carrier…">
                </div>

                <div class="field">
                    <label>ETA</label>
                    <input name="eta" type="date" th:value="${container.eta}">
                </div>

                <div class="field field--status">
                    <label>Status</label>
                    <select name="status"
                            class="pill"
                            th:classappend="${' pill--status-' + #strings.toLowerCase(#strings.replace(container.status,'_','-'))}">
                        <option th:each="s : ${containerStatusOptions}"
                                th:value="${s}"
                                th:text="${s}"
                                th:selected="${s == container.status}">
                        </option>
                    </select>
                </div>

            </div>

            <!-- FOOTER ACTIONS -->
            <div class="details-footer details-footer--right">
                <button type="submit" class="btn-sm btn-sm--save">Save</button>

                <button type="submit"
                        class="btn-sm btn-sm--danger"
                        th:formaction="@{/container-tracker/containers/{id}/delete(id=${container.id})}"
                        formmethod="post"
                        onclick="return confirm('Delete this container? This will delete all vehicles inside it.');">
                    Delete
                </button>
            </div>

        </form>
    </div>



    <div class="section-divider"></div>

        <div class="vehicles-header">
            <h2 class="section-head" style="margin:0;">Vehicles</h2>
        </div>

        <div class="table-wrap">
            <table class="table">
                <thead>
                <tr>
                    <thead>
                <tr>
                    <th>Description</th>
                    <th>VIN</th>
                    <th>Owner</th>
                    <th>Phone</th>
                    <th>Email</th>
                    <th>Paid</th>
                    <th>Titles</th>
                    <th>Status</th>
                </tr>
                </thead>

                </tr>
                </thead>

                <tbody>
                <th:block th:each="v : ${vehicles}">

                    <!-- MAIN INFO ROW -->
                    <tr class="vehicle-row">
                        <td th:text="${v.description}"></td>
                        <td><span class="kbd" th:text="${v.vin}"></span></td>
                        <td th:text="${v.ownerName}"></td>

                        <td>
                            <input class="input-sm" type="text" name="phone"
                                   th:value="${v.phone}" placeholder="Phone"
                                   th:attr="form=${'f__' + v.id}">
                        </td>

                        <td>
                            <input class="input-sm" type="email" name="email"
                                   th:value="${v.email}" placeholder="Email"
                                   th:attr="form=${'f__' + v.id}">
                        </td>

                        <!-- NEW: move Paid/Titles/Status to TOP ROW after Email -->
                        <td>
                            <select name="paid"
                                    class="pill"
                                    th:attr="form=${'f__' + v.id}"
                                    th:classappend="${' pill--paid-' + #strings.toLowerCase(#strings.replace(v.paid,'_','-'))}">
                                <option th:each="p : ${paidOptions}"
                                        th:value="${p}" th:text="${p}" th:selected="${p == v.paid}">
                                </option>
                            </select>
                        </td>

                        <td>
                            <select name="titles"
                                    class="pill"
                                    th:attr="form=${'f__' + v.id}"
                                    th:classappend="${' pill--titles-' + #strings.toLowerCase(#strings.replace(v.titles,'_','-'))}">
                                <option th:each="t : ${titlesOptions}"
                                        th:value="${t}" th:text="${t}" th:selected="${t == v.titles}">
                                </option>
                            </select>
                        </td>

                        <td>
                            <select name="status"
                                    class="pill"
                                    th:attr="form=${'f__' + v.id}"
                                    th:classappend="${' pill--status-' + #strings.toLowerCase(#strings.replace(v.status,'_','-'))}">
                                <option th:each="s : ${vehicleStatusOptions}"
                                        th:value="${s}" th:text="${s}" th:selected="${s == v.status}">
                                </option>
                            </select>
                        </td>
                    </tr>

                    <!-- META ROW: Notes + actions on the RIGHT -->
                    <tr class="vehicle-meta">
                        <td colspan="8">
                            <form class="vehicle-meta__form"
                                  th:id="${'f__' + v.id}"
                                  th:action="@{/container-tracker/containers/{cid}/vehicles/{vid}/update(cid=${container.id},vid=${v.id})}"
                                  method="post">

                                <div class="meta-line">
                                    <div class="meta-notes">
                                        <textarea name="notes"
                                                  class="notes-field"
                                                  rows="1"
                                                  placeholder="Internal notes…"
                                                  th:text="${v.notes}"></textarea>
                                    </div>

                                    <div class="meta-actions">
                                        <button type="submit" class="btn-sm btn-sm--save">Save</button>

                                        <button type="submit"
                                                class="btn-sm btn-sm--danger"
                                                th:formaction="@{/container-tracker/containers/{cid}/vehicles/{vid}/delete(cid=${container.id},vid=${v.id})}"
                                                formmethod="post"
                                                onclick="return confirm('Delete this vehicle? This cannot be undone.');">
                                            Delete
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </td>
                    </tr>

                </th:block>
                </tbody>


            </table>
        </div>

        <div class="section-divider"></div>

        <div class="vehicle-add">
            <div class="vehicle-add__head">
                <h2 class="section-head" style="margin:0;">Add Vehicle</h2>
                <p class="hint" style="margin:6px 0 0;">Попълни VIN, описание и собственик, после натисни Add Vehicle.</p>
            </div>

            <form class="vehicle-add__form"
                  th:action="@{/container-tracker/containers/{id}/vehicles(id=${container.id})}"
                  method="post" th:object="${newVehicle}">

                <div class="vehicle-add__grid">
                    <div>
                        <label>Description</label>
                        <input th:field="*{description}">
                    </div>

                    <div>
                        <label>VIN</label>
                        <input th:field="*{vin}">
                    </div>


                    <div>
                        <label>Owner Name</label>
                        <input th:field="*{ownerName}">
                    </div>
                    <div>
                        <label>Phone</label>
                        <input th:field="*{phone}">
                    </div>

                    <div>
                        <label>Email</label>
                        <input th:field="*{email}">
                    </div>

                    <div>
                        <label>Notes</label>
                        <input th:field="*{notes}">
                    </div>
                </div>

                <div class="vehicle-add__actions">
                    <button type="submit">Add Vehicle</button>
                </div>
            </form>
        </div>
    </div>
</div>
</body>
</html>
